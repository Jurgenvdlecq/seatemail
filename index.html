<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wittebrug E-mailgenerator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

```
* { 
  box-sizing: border-box; 
  margin: 0;
  padding: 0;
}

body { 
  font-family: 'Open Sans', sans-serif; 
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  color: #333; 
  min-height: 100vh;
}

.container { 
  max-width: 1400px; 
  margin: 0 auto; 
  padding: 20px; 
}

header { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  background: linear-gradient(135deg, #0033A0 0%, #004cbf 100%);
  color: #fff; 
  padding: 20px 30px; 
  border-radius: 12px; 
  box-shadow: 0 8px 32px rgba(0, 51, 160, 0.3);
  margin-bottom: 30px;
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.logo { 
  height: 50px; 
  width: auto;
  filter: brightness(0) invert(1);
}

header h1 {
  font-size: 1.8rem;
  font-weight: 700;
  margin: 0;
}

.language-selection {
  display: flex;
  align-items: center;
  gap: 10px;
}

.language-selection label { 
  font-weight: 600; 
  font-size: 0.9rem;
}

.language-selection select {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  font-weight: 600;
}

.language-selection select option {
  background: #0033A0;
  color: white;
}

main { 
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  gap: 30px; 
}

@media(max-width: 1024px) { 
  main { 
    grid-template-columns: 1fr; 
  }
}

.form-section, .preview-section { 
  background: #fff; 
  border-radius: 16px; 
  padding: 30px; 
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(0, 51, 160, 0.1);
}

.form-section h2, .preview-section h2 {
  color: #0033A0;
  font-size: 1.5rem;
  margin-bottom: 25px;
  font-weight: 700;
}

.fieldset-group { 
  border: 2px solid #e8f2ff; 
  border-radius: 12px; 
  padding: 25px; 
  background: linear-gradient(135deg, #f8fbff 0%, #e8f2ff 100%);
  margin-bottom: 25px; 
}

.fieldset-group legend {
  background: #0033A0;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
}

.field-group { 
  margin-bottom: 20px; 
}

.field-group label { 
  display: block; 
  font-weight: 600; 
  margin-bottom: 8px; 
  color: #333;
  font-size: 0.9rem;
}

.field-group input, .field-group select { 
  width: 100%; 
  padding: 12px 16px; 
  border: 2px solid #e0e6ed; 
  border-radius: 8px; 
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
}

.field-group input:focus, .field-group select:focus { 
  border-color: #0033A0; 
  outline: none; 
  box-shadow: 0 0 0 3px rgba(0, 51, 160, 0.1);
  transform: translateY(-1px);
}

.field-group input::placeholder {
  color: #94a3b8;
  font-style: italic;
}

.quick-actions { 
  background: #f0f9ff; 
  border: 2px solid #0ea5e9; 
  border-radius: 12px; 
  padding: 20px; 
  margin-bottom: 25px;
}

.quick-actions h3 {
  color: #0369a1;
  font-size: 1.1rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.quick-btn {
  background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.85rem;
  margin: 5px 5px 0 0;
  transition: all 0.3s ease;
}

.quick-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
}

.template-style {
  background: #fefce8;
  border: 2px solid #eab308;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 25px;
}

.template-style h3 {
  color: #a16207;
  font-size: 1.1rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.style-options {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.style-btn {
  background: white;
  color: #a16207;
  border: 2px solid #fbbf24;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.85rem;
  transition: all 0.3s ease;
}

.style-btn.active {
  background: #fbbf24;
  color: white;
}

.style-btn:hover {
  background: #fbbf24;
  color: white;
}

.follow-up-section {
  background: #f0fdf4;
  border: 2px solid #22c55e;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 25px;
}

.follow-up-section h3 {
  color: #166534;
  font-size: 1.1rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.reminder-row {
  display: flex;
  gap: 15px;
  align-items: center;
  margin-bottom: 10px;
}

.reminder-row input[type="date"], .reminder-row select {
  flex: 1;
}

.reminder-row button {
  background: #22c55e;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.85rem;
}

.reminder-list {
  margin-top: 15px;
}

.reminder-item {
  background: white;
  border: 1px solid #bbf7d0;
  border-radius: 6px;
  padding: 10px;
  margin-bottom: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.reminder-item .remove-btn {
  background: #ef4444;
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.8rem;
}

.button-row { 
  margin-top: 30px; 
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
}

.button-row button { 
  background: linear-gradient(135deg, #0033A0 0%, #004cbf 100%);
  color: #fff; 
  border: none; 
  padding: 14px 24px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.button-row button:hover:not(:disabled) { 
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 51, 160, 0.3);
}

.button-row button:active:not(:disabled) {
  transform: translateY(0);
}

.button-row button:disabled { 
  background: #94a3b8; 
  cursor: not-allowed; 
  transform: none;
}

.copy-btn {
  background: linear-gradient(135deg, #059669 0%, #10b981 100%) !important;
}

#output { 
  background: #f8fafc; 
  padding: 25px; 
  border-radius: 12px; 
  min-height: 400px; 
  overflow-y: auto; 
  border: 2px solid #e2e8f0;
  font-family: 'Open Sans', sans-serif;
  font-size: 0.95rem;
  line-height: 1.6;
  white-space: pre-wrap;
  color: #334155;
}

.subject-line {
  background: #e0f2fe;
  border: 1px solid #0ea5e9;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

.subject-line h4 {
  color: #0369a1;
  font-size: 1rem;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.subject-line .subject-text {
  background: white;
  padding: 10px;
  border-radius: 6px;
  font-weight: 600;
  color: #1e293b;
}

#feedback { 
  margin-top: 15px; 
  padding: 10px 15px;
  border-radius: 6px;
  font-weight: 600;
  text-align: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

#feedback.show {
  opacity: 1;
}

#feedback.success {
  background: #dcfce7;
  color: #166534;
  border: 1px solid #bbf7d0;
}

#feedback.error {
  background: #fef2f2;
  color: #dc2626;
  border: 1px solid #fecaca;
}

.validation-error {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
}

@media(max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  header {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .logo-section {
    justify-content: center;
  }
  
  .form-section, .preview-section {
    padding: 20px;
  }
  
  .fieldset-group {
    padding: 20px;
  }
  
  .button-row {
    flex-direction: column;
  }
  
  .button-row button {
    justify-content: center;
  }
  
  .reminder-row {
    flex-direction: column;
    align-items: stretch;
  }
  
  .style-options {
    justify-content: center;
  }
}
```

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-section">
        <img src="wittebrug_logo.png" alt="Wittebrug Logo" class="logo"/>
        <h1>E-mailgenerator</h1>
      </div>
      <div class="language-selection">
        <label for="languageSelect">Taal:</label>
        <select id="languageSelect">
          <option value="nl">Nederlands</option>
          <option value="en">English</option>
        </select>
      </div>
    </header>

```
<main>
  <section class="form-section">
    <h2>üìù Formulier</h2>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
      <h3>‚ö° Snelle acties</h3>
      <button type="button" class="quick-btn" onclick="fillDemoData()">Demo gegevens</button>
      <button type="button" class="quick-btn" onclick="fillSeatData()">SEATvoorbeeld</button>
      <button type="button" class="quick-btn" onclick="fillCupraData()">CUPRAvoorbeeld</button>
      <button type="button" class="quick-btn" onclick="clearForm()">Formulier wissen</button>
    </div>

    <!-- Template Style Selection -->
    <div class="template-style">
      <h3>üé® Toonzetting</h3>
      <div class="style-options">
        <button type="button" class="style-btn active" data-style="professioneel" onclick="selectStyle(this)">Professioneel</button>
        <button type="button" class="style-btn" data-style="vriendelijk" onclick="selectStyle(this)">Vriendelijk</button>
        <button type="button" class="style-btn" data-style="commercieel" onclick="selectStyle(this)">Commercieel</button>
      </div>
    </div>

    <form id="emailForm" novalidate>
      <!-- Klantgegevens -->
      <fieldset class="fieldset-group">
        <legend>üë§ Klantgegevens</legend>
        <div class="field-group">
          <label for="aanhef">Aanhef *</label>
          <select id="aanhef" required>
            <option value="">-- Kies aanhef --</option>
            <option value="heer">De heer</option>
            <option value="mevrouw">Mevrouw</option>
            <option value="voornaam">Voornaam</option>
          </select>
        </div>
        <div class="field-group">
          <label for="voornaam">Voornaam *</label>
          <input type="text" id="voornaam" required placeholder="Bijv. Anna"/>
        </div>
        <div class="field-group">
          <label for="achternaam">Achternaam *</label>
          <input type="text" id="achternaam" required placeholder="Bijv. Janssen"/>
        </div>
      </fieldset>
      
      <!-- Merk en Model -->
      <fieldset class="fieldset-group">
        <legend>üöó Merk en Model</legend>
        <div class="field-group">
          <label for="merk">Merk *</label>
          <select id="merk" required>
            <option value="">-- Kies merk --</option>
            <option value="SEAT">SEAT</option>
            <option value="CUPRA">CUPRA</option>
          </select>
        </div>
        <div class="field-group">
          <label for="model">Model *</label>
          <select id="model" required>
            <option value="">-- Kies model --</option>
          </select>
        </div>
      </fieldset>
      
      <!-- Type e-mail -->
      <fieldset class="fieldset-group">
        <legend>üìß Type e-mail</legend>
        <div class="field-group">
          <label for="emailtype">Type e-mail *</label>
          <select id="emailtype" required>
            <option value="">-- Kies type --</option>
            <option value="offerte">Offerte zonder inruil</option>
            <option value="inruil">Offerte met inruil</option>
            <option value="proefrit">Proefritbevestiging</option>
            <option value="afspraak">Afspraakbevestiging</option>
            <option value="showroom">Showroombezoek</option>
            <option value="lease">Private lease</option>
            <option value="followup">Follow-up offerte</option>
            <option value="status">Status levering</option>
          </select>
        </div>
      </fieldset>
      
      <!-- Specifieke gegevens -->
      <fieldset class="fieldset-group">
        <legend>üìä Specifieke gegevens</legend>
        <div class="field-group" id="veld-prijs" style="display:none;">
          <label for="prijs">Prijs (‚Ç¨) *</label>
          <input type="number" id="prijs" min="0" placeholder="25000"/>
        </div>
        <div class="field-group" id="veld-levertijd" style="display:none;">
          <label for="levertijd">Levertijd *</label>
          <input type="text" id="levertijd" placeholder="Bijv. 2 weken, 3 maanden"/>
        </div>
        <div class="field-group" id="veld-inruilprijs" style="display:none;">
          <label for="inruilprijs">Inruilprijs (‚Ç¨) *</label>
          <input type="number" id="inruilprijs" min="0" placeholder="15000"/>
        </div>
        <div class="field-group" id="veld-kenteken" style="display:none;">
          <label for="kenteken">Kenteken inruilauto *</label>
          <input type="text" id="kenteken" placeholder="XX-123-XX"/>
        </div>
        <div class="field-group" id="veld-datum" style="display:none;">
          <label for="datum">Datum *</label>
          <input type="date" id="datum"/>
        </div>
        <div class="field-group" id="veld-tijd" style="display:none;">
          <label for="tijd">Tijd *</label>
          <input type="time" id="tijd"/>
        </div>
        <div class="field-group" id="veld-looptijd" style="display:none;">
          <label for="looptijd">Looptijd (maanden) *</label>
          <input type="number" id="looptijd" min="1" placeholder="24"/>
        </div>
        <div class="field-group" id="veld-kilometers" style="display:none;">
          <label for="kilometers">Kilometers per jaar *</label>
          <input type="number" id="kilometers" min="0" placeholder="20000"/>
        </div>
        <div class="field-group" id="veld-eigenrisico" style="display:none;">
          <label for="eigenrisico">Eigen risico (‚Ç¨) *</label>
          <input type="number" id="eigenrisico" min="0" placeholder="500"/>
        </div>
        <div class="field-group" id="veld-maandbedrag" style="display:none;">
          <label for="maandbedrag">Maandbedrag (‚Ç¨) *</label>
          <input type="number" id="maandbedrag" min="0" placeholder="299"/>
        </div>
        <div class="field-group" id="veld-banden" style="display:none;">
          <label for="banden">Type banden *</label>
          <select id="banden">
            <option value="">-- Kies type banden --</option>
            <option value="Zomerbanden">Zomerbanden</option>
            <option value="Winterbanden">Winterbanden</option>
            <option value="Allseason banden">Allseason banden</option>
          </select>
        </div>
        <div class="field-group" id="veld-leverdatum" style="display:none;">
          <label for="leverdatum">Leverdatum *</label>
          <input type="date" id="leverdatum"/>
        </div>
      </fieldset>

      <!-- Follow-up Reminders -->
      <div class="follow-up-section">
        <h3>‚è∞ Follow-up herinneringen</h3>
        <div class="reminder-row">
          <input type="date" id="reminderDate" />
          <select id="reminderType">
            <option value="">-- Kies actie --</option>
            <option value="bellen">Klant bellen</option>
            <option value="email">Follow-up email</option>
            <option value="offerte">Nieuwe offerte sturen</option>
            <option value="proefrit">Proefrit aanbieden</option>
          </select>
          <button type="button" onclick="addReminder()">‚ûï Toevoegen</button>
        </div>
        <div class="reminder-list" id="reminderList">
          <!-- Dynamisch gevuld -->
        </div>
      </div>
      
      <!-- Knoppen -->
      <div class="button-row">
        <button type="button" id="generateBtn" disabled>
          üìß Genereer e-mail
        </button>
        <button type="button" id="outlookBtn" style="display:none;">
          ‚úâÔ∏è Open in Outlook
        </button>
        <button type="button" class="copy-btn" onclick="kopieerTekst()">
          üìã Kopieer tekst
        </button>
      </div>
    </form>
  </section>
  
  <!-- Preview -->
  <section class="preview-section">
    <h2>üëÅÔ∏è Preview</h2>
    <div class="subject-line" id="subjectLine" style="display:none;">
      <h4>üìß Onderwerp:</h4>
      <div class="subject-text" id="subjectText"></div>
    </div>
    <div id="output">Vul het formulier in om een e-mail te genereren...</div>
    <div id="feedback"></div>
  </section>
</main>
```

  </div>

  <script>
    // Wittebrug E-mailtool ‚Äì Enhanced versie
    const seatModels = ["Ibiza", "Leon", "Leon Sportstourer", "Arona", "Ateca"];
    const cupraModels = ["Born", "Formentor", "Leon", "Leon Sportstourer", "Terramar", "Tavascan"];
    
    let currentLang = 'nl';
    let currentStyle = 'professioneel';
    let reminders = [];

    // Subject line templates
    const subjectTemplates = {
      nl: {
        offerte: (merk, model) => `Uw offerte voor de ${merk} ${model}`,
        inruil: (merk, model) => `Offerte ${merk} ${model} inclusief inruil`,
        proefrit: (merk, model) => `Bevestiging proefrit ${merk} ${model}`,
        afspraak: (merk, model) => `Afspraak bevestiging - ${merk} ${model}`,
        showroom: (merk, model) => `Uitnodiging showroom - ${merk} ${model}`,
        lease: (merk, model) => `Private lease voorstel ${merk} ${model}`,
        followup: (merk, model) => `Follow-up: ${merk} ${model}`,
        status: (merk, model) => `Leverstatus update ${merk} ${model}`
      },
      en: {
        offerte: (merk, model) => `Your quote for the ${merk} ${model}`,
        inruil: (merk, model) => `Quote ${merk} ${model} including trade-in`,
        proefrit: (merk, model) => `Test drive confirmation ${merk} ${model}`,
        afspraak: (merk, model) => `Appointment confirmation - ${merk} ${model}`,
        showroom: (merk, model) => `Showroom invitation - ${merk} ${model}`,
        lease: (merk, model) => `Private lease proposal ${merk} ${model}`,
        followup: (merk, model) => `Follow-up: ${merk} ${model}`,
        status: (merk, model) => `Delivery status update ${merk} ${model}`
      }
    };

    // Helper functions
    function translateDuration(text) {
      if (!text) return '';
      const mapping = {
        'weken': 'weeks', 'week': 'week',
        'maanden': 'months', 'maand': 'month',
        'dagen': 'days', 'dag': 'day'
      };
      return text.replace(/(\d+)\s*(weken|week|maanden|maand|dagen|dag)/gi,
        (_, num, unit) => `${num} ${mapping[unit.toLowerCase()]}`);
    }

    function formatPriceNL(val) {
      const n = Number(val) || 0;
      return '‚Ç¨ ' + new Intl.NumberFormat('nl-NL').format(n) + ',-';
    }

    function formatDate(dateStr, lang = 'nl') {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      if (lang === 'nl') {
        return date.toLocaleDateString('nl-NL', { 
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
      } else {
        return date.toLocaleDateString('en-US', { 
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
      }
    }

    function formatTime(timeStr) {
      return timeStr || '';
    }

    // Quick Actions
    function fillDemoData() {
      document.getElementById('aanhef').value = 'voornaam';
      document.getElementById('voornaam').value = 'Emma';
      document.getElementById('achternaam').value = 'Bakker';
      document.getElementById('merk').value = 'SEAT';
      populateModels();
      setTimeout(() => {
        document.getElementById('model').value = 'Leon';
        document.getElementById('emailtype').value = 'offerte';
        document.getElementById('prijs').value = '28500';
        document.getElementById('levertijd').value = '6 weken';
        toggleFields();
        validateForm();
      }, 50);
      showFeedback('Demo gegevens ingevuld!', 'success');
    }

    function fillSeatData() {
      document.getElementById('merk').value = 'SEAT';
      populateModels();
      setTimeout(() => {
        document.getElementById('model').value = 'Arona';
        document.getElementById('emailtype').value = 'showroom';
        document.getElementById('prijs').value = '24900';
        document.getElementById('levertijd').value = '4 weken';
        toggleFields();
        validateForm();
      }, 50);
      showFeedback('SEAT voorbeelddata ingevuld!', 'success');
    }

    function fillCupraData() {
      document.getElementById('merk').value = 'CUPRA';
      populateModels();
      setTimeout(() => {
        document.getElementById('model').value = 'Formentor';
        document.getElementById('emailtype').value = 'lease';
        document.getElementById('looptijd').value = '48';
        document.getElementById('kilometers').value = '20000';
        document.getElementById('eigenrisico').value = '500';
        document.getElementById('maandbedrag').value = '399';
        document.getElementById('banden').value = 'Allseason banden';
        toggleFields();
        validateForm();
      }, 50);
      showFeedback('CUPRA voorbeelddata ingevuld!', 'success');
    }

    function clearForm() {
      document.getElementById('emailForm').reset();
      populateModels();
      toggleFields();
      validateForm();
      document.getElementById('output').innerText = 'Vul het formulier in om een e-mail te genereren...';
      document.getElementById('subjectLine').style.display = 'none';
      showFeedback('Formulier gewist!', 'success');
    }

    // Style selection
    function selectStyle(button) {
      document.querySelectorAll('.style-btn').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      currentStyle = button.dataset.style;
      if (document.getElementById('output').innerText !== 'Vul het formulier in om een e-mail te genereren...') {
        generateEmail();
      }
    }

    // Reminder management
    function addReminder() {
      const date = document.getElementById('reminderDate').value;
      const type = document.getElementById('reminderType').value;
      
      if (!date || !type) {
        showFeedback('Vul datum en actie in voor herinnering', 'error');
        return;
      }
      
      const reminder = { date, type, id: Date.now() };
      reminders.push(reminder);
      updateReminderList();
      
      document.getElementById('reminderDate').value = '';
      document.getElementById('reminderType').value = '';
      showFeedback('Herinnering toegevoegd!', 'success');
    }

    function removeReminder(id) {
      reminders = reminders.filter(r => r.id !== id);
      updateReminderList();
      showFeedback('Herinnering verwijderd!', 'success');
    }

    function updateReminderList() {
      const list = document.getElementById('reminderList');
      if (reminders.length === 0) {
        list.innerHTML = '';
        return;
      }
      
      const typeLabels = {
        bellen: 'üìû Klant bellen',
        email: 'üìß Follow-up email',
        offerte: 'üí∞ Nieuwe offerte',
        proefrit: 'üöó Proefrit aanbieden'
      };
      
      list.innerHTML = reminders.map(r => `
        <div class="reminder-item">
          <span>${formatDate(r.date)} - ${typeLabels[r.type]}</span>
          <button class="remove-btn" onclick="removeReminder(${r.id})">‚úï</button>
        </div>
      `).join('');
    }

    // Form validation and population
    window.addEventListener('DOMContentLoaded', () => {
      populateModels();
      toggleFields();
      validateForm();

      document.getElementById('merk').addEventListener('change', () => {
        populateModels(); 
        validateForm();
      });
      
      document.getElementById('emailtype').addEventListener('change', () => {
        toggleFields(); 
        validateForm();
      });
      
      document.getElementById('languageSelect').addEventListener('change', e => {
        currentLang = e.target.value;
        updateReminderList();
        if (document.getElementById('output').innerText !== 'Vul het formulier in om een e-mail te genereren...') {
          generateEmail();
        }
      });

      document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', () => {
          toggleFields(); 
          validateForm();
        });
      });

      document.getElementById('generateBtn').addEventListener('click', generateEmail);
      document.getElementById('outlookBtn').addEventListener('click', openOutlook);
    });

    function populateModels() {
      const m = document.getElementById('merk').value;
      const sel = document.getElementById('model');
      sel.innerHTML = '<option value="">-- Kies model --</option>';
      const list = m === 'SEAT' ? seatModels : (m === 'CUPRA' ? cupraModels : []);
      list.forEach(x => sel.innerHTML += `<option value="${x}">${x}</option>`);
    }

    function toggleFields() {
      const groups = {
        offerte: ['prijs', 'levertijd'],
        inruil: ['prijs', 'levertijd', 'inruilprijs', 'kenteken'],
        proefrit: ['datum', 'tijd'],
        afspraak: ['datum', 'tijd'],
        showroom: ['prijs', 'levertijd'],
        lease: ['looptijd', 'kilometers', 'eigenrisico', 'maandbedrag', 'banden'],
        followup: [],
        status: ['leverdatum']
      };
      
      const type = document.getElementById('emailtype').value;
      const all = ['prijs', 'levertijd', 'inruilprijs', 'kenteken', 'datum', 'tijd', 'looptijd', 'kilometers', 'eigenrisico', 'maandbedrag', 'banden', 'leverdatum'];
      
      all.forEach(id => {
        const el = document.getElementById('veld-' + id);
        if (el) {
          el.style.display = (groups[type] || []).includes(id) ? 'block' : 'none';
        }
      });
    }

    function validateForm() {
      const req = ['aanhef', 'voornaam', 'achternaam', 'merk', 'model', 'emailtype'];
      let ok = req.every(id => {
        const el = document.getElementById(id);
        const isValid = !!el.value;
        el.classList.toggle('validation-error', !isValid);
        return isValid;
      });
      
      const type = document.getElementById('emailtype').value;
      const groups = {
        offerte: ['prijs', 'levertijd'],
        inruil: ['prijs', 'levertijd', 'inruilprijs', 'kenteken'],
        proefrit: ['datum', 'tijd'],
        afspraak: ['datum', 'tijd'],
        showroom: ['prijs', 'levertijd'],
        lease: ['looptijd', 'kilometers', 'eigenrisico', 'maandbedrag', 'banden'],
        followup: [],
        status: ['leverdatum']
      };
      
      (groups[type] || []).forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          const isValid = !!el.value;
          el.classList.toggle('validation-error', !isValid);
          if (!isValid) ok = false;
        }
      });
      
      document.getElementById('generateBtn').disabled = !ok;
    }

    function generateSubject() {
      const type = document.getElementById('emailtype').value;
      const merk = document.getElementById('merk').value;
      const model = document.getElementById('model').value;
      
      if (!type || !merk || !model) return '';
      
      const templates = subjectTemplates[currentLang];
      return templates[type] ? templates[type](merk, model) : '';
    }

    function generateEmail() {
      const d = {
        naam: document.getElementById('voornaam').value.trim(),
        ak: document.getElementById('achternaam').value.trim(),
        merk: document.getElementById('merk').value,
        model: document.getElementById('model').value,
        prijs: document.getElementById('prijs').value,
        levertijd: document.getElementById('levertijd').value,
        inruilprijs: document.getElementById('inruilprijs').value,
        kenteken: document.getElementById('kenteken').value,
        datum: document.getElementById('datum').value,
        tijd: document.getElementById('tijd').value,
        looptijd: document.getElementById('looptijd').value,
        kilometers: document.getElementById('kilometers').value,
        eigenrisico: document.getElementById('eigenrisico').value,
        maandbedrag: document.getElementById('maandbedrag').value,
        banden: document.getElementById('banden').value,
        leverdatum: document.getElementById('leverdatum').value
      };
      
      // Subject line generation
      const subject = generateSubject();
      if (subject) {
        document.getElementById('subjectLine').style.display = 'block';
        document.getElementById('subjectText').innerText = subject;
      }
      
      // Aanhef-bepaling
      const a = document.getElementById('aanhef').value;
      let greet = '';
      if (currentLang === 'nl') {
        if (a === 'voornaam') greet = `Beste ${d.naam},`;
        else if (a === 'heer') greet = `Beste meneer ${d.ak},`;
        else greet = `Beste mevrouw ${d.ak},`;
      } else {
        if (a === 'voornaam') greet = `Dear ${d.naam},`;
        else if (a === 'heer') greet = `Dear Mr. ${d.ak},`;
        else greet = `Dear Ms. ${d.ak},`;
      }
      
      // Template variations based on style
      const getStyleModifier = (base) => {
        if (currentStyle === 'vriendelijk') {
          return base.replace(/Hartelijk dank/g, 'Heel hartelijk dank')
                     .replace(/Met vriendelijke groet,/g, 'Met de vriendelijkste groeten,')
                     .replace(/U bent van harte welkom/g, 'Wij verwelkomen u graag');
        } else if (currentStyle === 'commercieel') {
          return base.replace(/Hartelijk dank/g, 'Dank u wel')
                     .replace(/circa/g, 'slechts')
                     .replace(/U bent van harte welkom/g, 'Profiteer nu van deze kans en bezoek')
                     + '\n\nüéØ Beperkte tijd beschikbaar - neem snel contact op!';
        }
        return base; // professioneel style
      };
      
      // Nederlandse templates
      const tplNL = {
        offerte: d => getStyleModifier(`${greet}

Hartelijk dank voor uw interesse in de ${d.merk} ${d.model}.

De totale aanschafprijs bedraagt ${formatPriceNL(d.prijs)}
De geschatte levertijd is circa ${d.levertijd} na akkoord.

In de bijlage vindt u de complete offerte met alle specificaties en opties.

U bent van harte welkom in onze showroom voor een bezichtiging of proefrit. 
Mocht u nog vragen hebben, dan hoor ik dat graag van u.`),

        inruil: d => getStyleModifier(`${greet}

Hartelijk dank voor uw interesse in de ${d.merk} ${d.model}.

De totale aanschafprijs bedraagt ${formatPriceNL(d.prijs)}
Voor uw huidige auto (${d.kenteken}) kunnen wij ${formatPriceNL(d.inruilprijs)} inruil bieden.
Uw totale investering komt daarmee uit op ${formatPriceNL(d.prijs - d.inruilprijs)}

De geschatte levertijd is circa ${d.levertijd} na akkoord.

In de bijlage vindt u de complete offerte inclusief inruilwaardering.

Graag plan ik een afspraak in om de inruilauto te bekijken en de nieuwe auto te bespreken.`),

        proefrit: d => getStyleModifier(`${greet}

Hierbij bevestig ik uw proefrit afspraak voor de ${d.merk} ${d.model}.

Datum: ${formatDate(d.datum)}
Tijd: ${formatTime(d.tijd)}

U kunt zich melden bij de receptie. Zorg ervoor dat u uw rijbewijs meeneemt.
Tijdens de proefrit krijgt u alle informatie over de auto en kunnen we uw vragen beantwoorden.

Mocht u de afspraak moeten verzetten, neem dan contact met ons op.`),

        afspraak: d => getStyleModifier(`${greet}

Hierbij bevestig ik onze afspraak aangaande de ${d.merk} ${d.model}.

Datum: ${formatDate(d.datum)}
Tijd: ${formatTime(d.tijd)}

Tijdens dit gesprek bespreken we uw wensen en kunnen we een passend voorstel doen.
U bent welkom in onze showroom waar u de auto kunt bekijken.

Mocht u de afspraak moeten verzetten, laat het me dan weten.`),

        showroom: d => getStyleModifier(`${greet}

Graag nodig ik u uit voor een bezoek aan onze showroom om de ${d.merk} ${d.model} te bekijken.

De totale aanschafprijs bedraagt ${formatPriceNL(d.prijs)}
De geschatte levertijd is circa ${d.levertijd} na akkoord.

In onze showroom kunt u:
- De auto van dichtbij bekijken
- Een proefrit maken
- Alle opties en accessoires bekijken
- Uw financieringsmogelijkheden bespreken

Onze openingstijden zijn ma-vr 9:00-18:00 en za 9:00-17:00.
Voor een proefrit maken we graag een afspraak.`),

        lease: d => getStyleModifier(`${greet}

Hartelijk dank voor uw interesse in private lease van de ${d.merk} ${d.model}.

Uw private lease voorstel:
- Looptijd: ${d.looptijd} maanden  
- Kilometers per jaar: ${Number(d.kilometers).toLocaleString('nl-NL')} km
- Maandbedrag: ${formatPriceNL(d.maandbedrag)} (incl. BTW)
- Eigen risico: ${formatPriceNL(d.eigenrisico)}
- Type banden: ${d.banden}

In het maandbedrag is inbegrepen:
- Wegenbelasting
- Verzekering (WA, casco, inzittenden)
- Onderhoud en reparaties
- APK
- Pechhulp

In de bijlage vindt u de volledige lease offerte met alle voorwaarden.`),

        followup: d => getStyleModifier(`${greet}

Een week geleden hebben we u een offerte gestuurd voor de ${d.merk} ${d.model}.

Ik wilde even checken of u nog vragen heeft over het voorstel, of dat ik ergens mee kan helpen bij uw beslissing.

Mocht u aanvullende informatie willen, een proefrit willen maken, of andere vragen hebben, dan hoor ik dat graag.

Ook als u besluit niet bij ons te kopen, stel ik feedback op prijs zodat wij onze service kunnen verbeteren.`),

        status: d => getStyleModifier(`${greet}

Hierbij een update over de levering van uw ${d.merk} ${d.model}.

Verwachte leverdatum: ${formatDate(d.leverdatum)}

We houden u op de hoogte van eventuele wijzigingen in het levermoment.
Ongeveer een week voor levering nemen we contact op om de aflevering af te spreken.

Mocht u vragen hebben over de levering, neem dan gerust contact op.`)
      };

      // Engelse templates (simplified for space)
      const tplEN = {
        offerte: d => `${greet}

Thank you for your interest in the ${d.merk} ${d.model}.

The total purchase price is ${formatPriceNL(d.prijs)} including delivery costs.
The estimated delivery time is approximately ${translateDuration(d.levertijd)} upon confirmation.

You'll find the complete quote with all specifications and options attached.

You're welcome to visit our showroom for a viewing or test drive.
If you have any questions, please don't hesitate to contact me.`,

        inruil: d => `${greet}

Thank you for your interest in the ${d.merk} ${d.model}.

The total purchase price is ${formatPriceNL(d.prijs)}
For your current car (${d.kenteken}) we can offer ${formatPriceNL(d.inruilprijs)} as trade-in value.
Your total investment would be ${formatPriceNL(d.prijs - d.inruilprijs)}

The estimated delivery time is approximately ${translateDuration(d.levertijd)} upon confirmation.

You'll find the complete quote including trade-in valuation attached.

I'd like to schedule an appointment to inspect your trade-in vehicle and discuss the new car.`,

        proefrit: d => `${greet}

This confirms your test drive appointment for the ${d.merk} ${d.model}.

Date: ${formatDate(d.datum, 'en')}
Time: ${formatTime(d.tijd)}

Please report to reception and bring your driving license.
During the test drive, you'll receive all information about the car and we can answer your questions.

If you need to reschedule, please contact us.`,

        afspraak: d => `${greet}

This confirms our appointment regarding the ${d.merk} ${d.model}.

Date: ${formatDate(d.datum, 'en')}
Time: ${formatTime(d.tijd)}

During this meeting we'll discuss your requirements and can make a suitable proposal.
You're welcome in our showroom where you can view the car.

If you need to reschedule, please let me know.`,

        showroom: d => `${greet}

I'd like to invite you to visit our showroom to view the ${d.merk} ${d.model}.

The total purchase price is ${formatPriceNL(d.prijs)}
The estimated delivery time is approximately ${translateDuration(d.levertijd)} upon confirmation.

In our showroom you can:
- View the car up close
- Take a test drive
- See all options and accessories
- Discuss your financing options

Our opening hours are Mon-Fri 9:00-18:00 and Sat 9:00-17:00.
We'd be happy to schedule an appointment for a test drive.`,

        lease: d => `${greet}

Thank you for your interest in private leasing the ${d.merk} ${d.model}.

Your private lease proposal:
- Contract term: ${d.looptijd} months
- Kilometers per year: ${Number(d.kilometers).toLocaleString('en-US')} km
- Monthly payment: ${formatPriceNL(d.maandbedrag)} (incl. VAT)
- Deductible: ${formatPriceNL(d.eigenrisico)}
- Tire type: ${d.banden}

The monthly payment includes:
- Road tax
- Insurance (liability, comprehensive, occupants)
- Maintenance and repairs
- MOT
- Roadside assistance

You'll find the complete lease quote with all terms attached.`,

        followup: d => `${greet}

A week ago we sent you a quote for the ${d.merk} ${d.model}.

I wanted to check if you have any questions about the proposal, or if I can help you with your decision in any way.

If you'd like additional information, want to schedule a test drive, or have other questions, I'd be happy to hear from you.

Even if you decide not to purchase from us, I appreciate feedback so we can improve our service.`,

        status: d => `${greet}

Here's an update on the delivery of your ${d.merk} ${d.model}.

Expected delivery date: ${formatDate(d.leverdatum, 'en')}

We'll keep you informed of any changes to the delivery timing.
About a week before delivery, we'll contact you to arrange the handover.

If you have any questions about the delivery, please don't hesitate to contact us.`
      };

      const type = document.getElementById('emailtype').value;
      const templates = currentLang === 'en' ? tplEN : tplNL;
      
      if (templates[type]) {
        const body = templates[type](d);
        document.getElementById('output').innerText = body;
        document.getElementById('outlookBtn').style.display = 'inline-flex';
      } else {
        document.getElementById('output').innerText = 'Template niet gevonden voor dit email type.';
      }
    }

    function openOutlook() {
      const subject = document.getElementById('subjectText').innerText || 
                     (currentLang === 'nl' ? 'Voorstel Wittebrug' : 'Your Quote from Wittebrug');
      const body = encodeURIComponent(document.getElementById('output').innerText);
      window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${body}`;
    }

    function kopieerTekst() {
      const output = document.getElementById('output');
      const feedback = document.getElementById('feedback');
      
      if (output.innerText === 'Vul het formulier in om een e-mail te genereren...') {
        showFeedback('Geen tekst om te kopi√´ren. Genereer eerst een e-mail.', 'error');
        return;
      }
      
      const subject = document.getElementById('subjectText').innerText;
      const fullText = subject ? `Onderwerp: ${subject}\n\n${output.innerText}` : output.innerText;
      
      navigator.clipboard.writeText(fullText)
        .then(() => {
          showFeedback(currentLang === 'nl' ? '‚úÖ Tekst gekopieerd!' : '‚úÖ Text copied!', 'success');
        })
        .catch(() => {
          showFeedback(currentLang === 'nl' ? '‚ùå Kopi√´ren mislukt' : '‚ùå Copy failed', 'error');
        });
    }

    function showFeedback(message, type) {
      const feedback = document.getElementById('feedback');
      feedback.innerText = message;
      feedback.className = `show ${type}`;
      setTimeout(() => {
        feedback.classList.remove('show');
      }, 3000);
    }
  </script>

</body>
</html>
